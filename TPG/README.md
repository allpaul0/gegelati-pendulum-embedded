# TPG directory

This folder comprises the TPGs intended for the following purposes:

1. Training
2. Code generation
3. Evaluation for energy consumption on the embedded system
4. Generating graphs using the data obtained from training or inference.

A valid TPG directory tree has a structure as follows :

* TPG/
    * *Name for your TPG directory (note\*) */
        * <span style="color:#FF6666;">**src/**</span>
            * <span style="color:#6495ED;">instructions.cpp</span> **(required for training)** --> provides a function 
            `void fillInstructionSet(Instructions::Set& set)` which will add all instructions used 
            to train the TPG to an `Instruction::Set` object
            * <span style="color:#6495ED;">params.json</span> **(required for training)** --> training parameters defining the TPG's structure
        * <span style="color:#FF6666;">**training/**</span> **(generated by 1.)**
            * dotfiles/ 
                * out_XXX.dot --> contains the best TPG generated at each generation
                * <span style="color:#6495ED;">out_best.dot</span> **(required for CodeGen)** best fitting TPG
            * bestPolicyStats.md --> stats on each generation of the training
            * out_best_stats.md --> stats on best TPG
            * train.csv/train.log --> performance metrics on the training
            * exported_params.json --> parameters used for training
        * <span style="color:#FF6666;">**CodeGen/**</span> **(generated by 2.)**
            * <span style="color:#6495ED;">TPGGraph.c/.h</span>, <span style="color:#6495ED;">TPGprograms.c/.h</span> **(required for inference compilation)** --> codegen files of the TPG
            * <span style="color:#6495ED;">PendulumEmbeddedMeasures.elf</span> **(required for inference)** --> binary containing the TPG + execution environment + energyBenchmarks + TimingBenchmarks
        * <span style="color:#FF6666;">**timestamp_inference_results /**</span> **(generated by 3.)** --> for each energy measurement
            * energy.log    --> STM32 board output to PC
            * energy_data.json  --> enegy measurements results (extracted from energy.log)
            * executionStats.json --> execution statistics of the TPG during the energy measurement
            * graph.png/.html --> current and power curves of the energy measurement
            * execution_stats.html / instructions_stats.html --> plots for energy_data.json and executionStats.json

1. Train your Pendulum TPGs with the Trainer-Generator project.
    Execute the script `start_trainings.rb` in the `scripts` directory.
2. If you are satified with the performance of the TPG during training, 2. Code generation, 3. Evaluation of the algo on the embedded system and 4. Data analysis can all be done at once by executing the script `startAllEnergyBench.rb` in the `scripts` directory.
 
(note\*) Multiple TPGs can be trained, with different pairs of `instructions.cpp` and `params.json`, you just need to create multiple directories. 

n.b. The reward function is fixed inside of the PendulumLearningEnvironment